package com.example.ndk;

import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStreamReader;

import android.app.Activity;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.Signature;
import android.os.Bundle;
import android.util.Log;
import android.widget.Toast;

public class MainActivity extends Activity {
	String result = null;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);

		String runinwhereString = isrunninginEmualtor();
		Toast.makeText(getApplicationContext(), runinwhereString, 0).show();
		isDebuggerable();
	}

	// 查询os
	public String getOs() {
		String os = System.getProperty("os.name").substring(0, 3);
		return os;
	}

	// 查询是否在模拟器中运行,
	public String isrunninginEmualtor() {
		Process ps = null;
		DataOutputStream doStream = null;
		BufferedReader inBufferedReader = null;
		try {
			ps = Runtime.getRuntime().exec("getprop ro.kernel.qemu");
			// 执行getprop
			doStream = new DataOutputStream(ps.getOutputStream());
			inBufferedReader = new BufferedReader(new InputStreamReader(
					ps.getInputStream(), "GBK"));
			doStream.writeBytes("exit\n");
			doStream.flush();
			ps.wait();
			result = inBufferedReader.readLine();

		} catch (Exception e) {
			// TODO: handle exception
		} finally {
			if (doStream != null) {
				try {
					doStream.close();
					inBufferedReader.close();
					ps.destroy();// Y束M程
				} catch (IOException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
		return result;
	}

	// zy是否是被榭烧{B
	public void isDebuggerable() {
		if ((getApplicationInfo().flags &= getApplicationInfo().FLAG_DEBUGGABLE) != 0) {
			Toast.makeText(getApplicationContext(), getApplicationInfo().flags,
					0).show();
		} else {
			Toast.makeText(getApplicationContext(), getApplicationInfo().flags,
					0).show();
		}

	}

	// zy是否被{了
	public void isbeingdebuger() {
		Boolean bl = android.os.Debug.isDebuggerConnected();
		while (bl) {
			Log.i("debuger", "being");
		}
	}

	// 检测签名
	public int getSingnatrue(String packageName) {
		PackageManager pManager = getPackageManager();
		PackageInfo piInfo = null;
		int signatrue=0;
		try {
piInfo=pManager.getPackageInfo(packageName, PackageManager.GET_SIGNATURES);
Signature[] signatures=piInfo.signatures;
		} catch (Exception e) {
		}

		return 0;
	}
	// 检测dex文件的hash值（用md5或者是crc都可以）

}
